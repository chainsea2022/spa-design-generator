<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPAè¨­è¨ˆæŒ‡ä»¤ç”Ÿæˆå™¨</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #a8b5a0 0%, #9caa95 100%);
      min-height: 100vh;
      color: #333;
    }
    .container {
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: linear-gradient(135deg, #a8b5a0 0%, #9caa95 100%);
      color: white;
      padding: 18px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header h1 { font-size: 1.6rem; font-weight: 400; }
    .header-buttons { display: flex; gap: 10px; }
    .btn {
      padding: 8px 18px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn-header { background: rgba(255, 255, 255, 0.9); color: #6b7c63; }
    .btn-primary { background: #a8b5a0; color: white; }
    .btn-warning { background: #d4b896; color: white; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
    
    .main-layout {
      flex: 1;
      display: flex;
      background: #f8f6f2;
    }
    .form-section {
      flex: 1;
      overflow-y: auto;
      padding: 25px;
    }
    .output-section {
      width: 450px;
      background: #f8f6f2;
      border-left: 1px solid #e0e0e0;
      padding: 25px;
      display: flex;
      flex-direction: column;
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .output-title { font-size: 1.3rem; font-weight: 600; }
    .output-actions { display: flex; gap: 8px; }
    .output-content {
      background: #2c2c2c;
      color: #e8e6e0;
      border-radius: 10px;
      padding: 18px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      flex: 1;
      overflow-y: auto;
    }
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
      text-align: center;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 22px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 18px;
      padding-bottom: 8px;
      border-bottom: 2px solid #a8b5a0;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .form-group { margin-bottom: 16px; }
    .form-group.full { grid-column: 1 / -1; }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 13px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 13px;
      background: #fafafa;
      font-family: inherit;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #a8b5a0;
      background: white;
    }
    textarea { resize: vertical; min-height: 80px; }
    .custom-input { margin-top: 6px; display: none; }
    
    .model-list {
      max-height: 280px;
      overflow-y: auto;
      margin-top: 12px;
    }
    .model-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: #f8f8f8;
      border: 1px solid #eee;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }
    .model-item:hover {
      background: #f0f0f0;
      border-color: #a8b5a0;
    }
    .model-item.selected {
      background: rgba(168, 181, 160, 0.1);
      border-color: #a8b5a0;
    }
    .model-item input[type="checkbox"] {
      width: 16px;
      height: 16px;
      margin: 0;
      accent-color: #a8b5a0;
      cursor: pointer;
      pointer-events: auto;
    }
    .model-item label {
      margin: 0;
      cursor: pointer;
      flex: 1;
      font-size: 12px;
      font-weight: 500;
      pointer-events: none;
    }
    
    .angle-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .angle-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      background: #f8f8f8;
      border-radius: 8px;
      cursor: pointer;
    }
    .angle-option input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #a8b5a0;
      cursor: pointer;
    }
    .angle-option label {
      margin: 0;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
    }
    
    .generate-btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      font-weight: 600;
      background: linear-gradient(135deg, #8b9d83 0%, #6b7c63 100%);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      margin-top: 20px;
    }
    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 124, 99, 0.3);
    }
    
    .toast {
      position: fixed;
      top: 90px;
      right: 20px;
      padding: 10px 16px;
      border-radius: 8px;
      color: white;
      font-size: 13px;
      z-index: 1000;
      transform: translateX(300px);
      transition: transform 0.3s;
    }
    .toast.show { transform: translateX(0); }
    .toast.success { background: #8b9d83; }
    .toast.error { background: #c4a882; }
    .toast.info { background: #a8b5a0; }
    
    .upload-zone {
      border: 2px dashed #ccc;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.2s;
    }
    .upload-zone:hover {
      border-color: #a8b5a0;
      background: #f5f5f5;
    }
    
    .history-list {
      max-height: 400px;
      overflow-y: auto;
    }
    .history-item {
      background: #f8f8f8;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      transition: all 0.2s;
    }
    .history-item:hover {
      background: #f0f0f0;
      border-color: #a8b5a0;
    }
    .history-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .history-title {
      font-weight: 600;
      font-size: 14px;
      color: #333;
      flex: 1;
    }
    .history-actions {
      display: flex;
      gap: 6px;
    }
    .history-btn {
      padding: 4px 10px;
      font-size: 11px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .history-btn-load {
      background: #a8b5a0;
      color: white;
    }
    .history-btn-delete {
      background: #d4a882;
      color: white;
    }
    .history-btn:hover {
      opacity: 0.8;
    }
    .history-time {
      font-size: 11px;
      color: #999;
    }
    .history-preview {
      font-size: 12px;
      color: #666;
      line-height: 1.4;
      margin-top: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #a8b5a0;
    }
    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      flex: 1;
    }
    .modal-header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .modal-close {
      font-size: 24px;
      cursor: pointer;
      color: #999;
      background: none;
      border: none;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-close:hover {
      color: #333;
    }
    .btn-clear-all {
      padding: 6px 14px;
      font-size: 12px;
      background: #d4a882;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-clear-all:hover {
      opacity: 0.8;
    }
    
    @media (max-width: 768px) {
      .form-grid, .angle-grid { grid-template-columns: 1fr; }
      .header { flex-direction: column; gap: 12px; }
      .history-item-header { flex-direction: column; align-items: flex-start; gap: 8px; }
      .main-layout { flex-direction: column; }
      .output-section { width: 100%; border-left: none; border-top: 1px solid #e0e0e0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>SPA è¨­è¨ˆæŒ‡ä»¤ç”Ÿæˆå™¨</h1>
      <div class="header-buttons">
        <button class="btn btn-header" onclick="showHistory()">æ­·ç¨‹ç´€éŒ„</button>
        <button class="btn btn-header" onclick="fillExample()">å¡«å…¥ç¯„ä¾‹</button>
        <button class="btn btn-header" onclick="clearForm()">æ¸…ç©ºè¡¨å–®</button>
      </div>
    </header>

    <div class="main-layout">
      <div class="form-section">
        <div class="card">
          <div class="card-title">åŸºæœ¬è³‡è¨Š</div>
          <div class="form-group">
            <label>èª²ç¨‹æ¨™é¡Œ</label>
            <input type="text" id="title" placeholder="è«‹è¼¸å…¥SPAèª²ç¨‹æ¨™é¡Œ...">
          </div>
          <div class="form-group">
            <label>èª²ç¨‹å…§å®¹æè¿°</label>
            <textarea id="content" placeholder="è«‹è©³ç´°æè¿°èª²ç¨‹å…§å®¹..."></textarea>
          </div>
        </div>

        <div class="card">
          <div class="card-title">è¨­è¨ˆé¢¨æ ¼è¨­å®š</div>
          <div class="form-grid">
            <div class="form-group">
              <label>é¢¨æ ¼åŸºèª¿ <span style="color: #999; font-size: 11px;">(æ•´é«”è¦–è¦ºé¢¨æ ¼)</span></label>
              <select id="style">
                <option>ç¦ªé¢¨</option>
                <option>æ¥µç°¡</option>
                <option>å¥¢è¯</option>
                <option>è‡ªç„¶</option>
                <option>åº¦å‡</option>
                <option>åŒ—æ­</option>
                <option>éŸ“ç³»</option>
                <option>æ—¥ç³»</option>
                <option>å¥¶æ²¹é¢¨</option>
                <option>å·¥æ¥­é¢¨</option>
                <option>å¾©å¤</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="styleOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–é¢¨æ ¼...">
            </div>
            <div class="form-group">
              <label>é¢¨æ ¼èª¿æ€§ <span style="color: #999; font-size: 11px;">(æƒ…æ„Ÿæ°›åœ)</span></label>
              <select id="tone">
                <option>ç¾ä»£</option>
                <option>å‚³çµ±</option>
                <option>æ¸…æ–°</option>
                <option>æº«é¦¨</option>
                <option>å°ˆæ¥­</option>
                <option>é«˜ç´š</option>
                <option>è¼•å¥¢</option>
                <option>å…¸é›…</option>
                <option>æ´»åŠ›</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="toneOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–èª¿æ€§...">
            </div>
            <div class="form-group">
              <label>è‰²èª¿ä¸»é¡Œ</label>
              <select id="colorTheme">
                <option>ç±³ç™½ç°</option>
                <option>æš–ç™½</option>
                <option>å†·ç°</option>
                <option>ç²‰è†š</option>
                <option>è–„è·</option>
                <option>é¦™æª³é‡‘</option>
                <option>å¤§åœ°è‰²</option>
                <option>è«è˜­è¿ªè‰²</option>
                <option>å¥¶èŒ¶è‰²</option>
                <option>éœ§è—</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="colorThemeOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–è‰²èª¿...">
            </div>
            <div class="form-group">
              <label>å…‰ç·šæ•ˆæœ</label>
              <select id="lighting">
                <option>æŸ”å…‰</option>
                <option>æš–å…‰</option>
                <option>å†·å…‰</option>
                <option>è‡ªç„¶å…‰</option>
                <option>æ°›åœå…‰</option>
                <option>å´å…‰</option>
                <option>é ‚å…‰</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="lightingOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–å…‰ç·š...">
            </div>
            <div class="form-group">
              <label>å ´æ™¯èƒŒæ™¯</label>
              <select id="scene">
                <option>é«˜ç´šSPAå®¤å…§</option>
                <option>ç§äººç™‚ç¨‹åŒ…å»‚</option>
                <option>æ°´ç™‚ä¸­å¿ƒ</option>
                <option>åº¦å‡æ‘SPA</option>
                <option>åŸå¸‚ç²¾å“SPA</option>
                <option>æ£®æ—ç³»SPA</option>
                <option>æµ·æ™¯SPA</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="sceneOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–å ´æ™¯...">
            </div>
            <div class="form-group">
              <label>æè³ªå…ƒç´ </label>
              <select id="material">
                <option>å¤§ç†çŸ³</option>
                <option>æœ¨è³ª</option>
                <option>æ£‰è³ª</option>
                <option>ç²¾æ²¹</option>
                <option>ç«¹æ</option>
                <option>çŸ³æ</option>
                <option>è—¤ç·¨</option>
                <option>çµ²ç¶¢</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
              <input type="text" id="materialOther" class="custom-input" placeholder="è«‹è¼¸å…¥å…¶ä»–æè³ª...">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">äººç‰©æ¨¡ç‰¹è¨­å®š</div>
          <div class="model-list">
            <div class="model-item" onclick="toggleModel(1, event)">
              <input type="checkbox" id="model1" onclick="event.stopPropagation()">
              <label for="model1">å„ªé›…äºæ´²å¥³æ€§ 25-35æ­²,æº«æŸ”æ°£è³ª,æ”¾é¬†è¡¨æƒ…</label>
            </div>
            <div class="model-item" onclick="toggleModel(2, event)">
              <input type="checkbox" id="model2" onclick="event.stopPropagation()">
              <label for="model2">æˆç†Ÿäºæ´²å¥³æ€§ 35-45æ­²,çŸ¥æ€§ç¾æ„Ÿ,å°ˆæ¥­è­·ç†</label>
            </div>
            <div class="model-item" onclick="toggleModel(3, event)">
              <input type="checkbox" id="model3" onclick="event.stopPropagation()">
              <label for="model3">å¹´è¼•äºæ´²å¥³æ€§ 20-28æ­²,æ¸…æ–°è‡ªç„¶,æ„‰æ‚…å¾®ç¬‘</label>
            </div>
            <div class="model-item" onclick="toggleModel(4, event)">
              <input type="checkbox" id="model4" onclick="event.stopPropagation()">
              <label for="model4">å•†å‹™äºæ´²ç”·æ€§ 30-40æ­²,å¥é«”ç·šæ¢,èˆ’ç·©ç‹€æ…‹</label>
            </div>
            <div class="model-item" onclick="toggleModel(5, event)">
              <input type="checkbox" id="model5" onclick="event.stopPropagation()">
              <label for="model5">å¥èº«äºæ´²ç”·æ€§ 25-35æ­²,è‚Œç†åˆ†æ˜,é¤Šç”Ÿæ”¾é¬†</label>
            </div>
            <div class="model-item" onclick="toggleModel(6, event)">
              <input type="checkbox" id="model6" onclick="event.stopPropagation()">
              <label for="model6">äºæ´²æƒ…ä¾¶æª”,æµªæ¼«æ°›åœ,é›™äººSPAé«”é©—</label>
            </div>
            <div class="model-item" onclick="toggleModel(7, event)">
              <input type="checkbox" id="model7" onclick="event.stopPropagation()">
              <label for="model7">äºæ´²é–¨èœœçµ„,è¼•é¬†æ„‰å¿«,å‹èª¼æ™‚å…‰</label>
            </div>
            <div class="model-item" onclick="toggleModel(8, event)">
              <input type="checkbox" id="model8" onclick="event.stopPropagation()">
              <label for="model8">è³‡æ·±äºæ´²å¥³æ€§ 45+æ­²,å„ªé›…å¾å®¹,è²´å©¦æ°£æ¯</label>
            </div>
            <div class="model-item" onclick="toggleModel(9, event)">
              <input type="checkbox" id="model9" onclick="event.stopPropagation()">
              <label for="model9">äºæ´²æ²»ç™‚å¸«,å°ˆæ¥­æ‰‹æŠ€,æœå‹™ä¸­ç‹€æ…‹</label>
            </div>
            <div class="model-item" onclick="toggleModel(10, event)">
              <input type="checkbox" id="model10" onclick="event.stopPropagation()">
              <label for="model10">æ··è¡€äºæ´²å¥³æ€§,åœ‹éš›ç¾æ„Ÿ,æ™‚å°šè³ªæ„Ÿ</label>
            </div>
            <div class="model-item" onclick="toggleModel(11, event)">
              <input type="checkbox" id="model11" onclick="event.stopPropagation()">
              <label for="model11">ç„¡äººå ´æ™¯,ç´”ç’°å¢ƒå±•ç¤º,ç©ºé–“ç¾å­¸</label>
            </div>
            <div class="model-item" onclick="toggleModel(12, event)">
              <input type="checkbox" id="model12" onclick="event.stopPropagation();">
              <label for="model12">å…¶ä»–</label>
            </div>
          </div>
          <div id="customModelInput" style="display: none; margin-top: 12px;">
            <label>è‡ªå®šç¾©äººç‰©æ¨¡ç‰¹æè¿°</label>
            <textarea id="customModel" placeholder="ä¾‹å¦‚:30æ­²å„ªé›…æ­ç¾å¥³æ€§,é‡‘é«®æ³¢æµª..."></textarea>
          </div>
        </div>

        <div class="card">
          <div class="card-title">å„€å™¨ç¤ºæ„åœ–è¨­å®š</div>
          <div class="form-group full">
            <label>ä¸Šå‚³å„€å™¨åœ–ç‰‡ <span style="color: #999;">(å¯é¸ä¸Šå‚³å¤šå¼µ)</span></label>
            <div class="upload-zone" onclick="document.getElementById('deviceInput').click()">
              <input type="file" id="deviceInput" accept="image/*" multiple style="display: none;">
              <div style="font-size: 18px; margin-bottom: 8px; color: #a8b5a0;">ğŸ“·</div>
              <div>é»æ“Šä¸Šå‚³å„€å™¨åœ–ç‰‡(å¯é¸å¤šå¼µ)</div>
            </div>
            <div id="devicePreview" style="margin-top: 12px; display: none;"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">æ‹æ”è§’åº¦è¨­å®š</div>
          <div class="form-group full">
            <label>æ‹æ”è§’åº¦é¸æ“‡(å¯å¤šé¸)</label>
            <div class="angle-grid">
              <div class="angle-option" onclick="toggleAngle(1, event)">
                <input type="checkbox" id="angle1" value="æ­£é¢å¹³è¦–ï¼Œçœ¼ç¥æ¥è§¸ï¼Œå±•ç¾è‡‰éƒ¨è¡¨æƒ…" checked onclick="event.stopPropagation()">
                <label for="angle1">æ­£é¢å¹³è¦–</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(2, event)">
                <input type="checkbox" id="angle2" value="30-45åº¦å´é¢è§’åº¦ï¼Œå±•ç¾å´è‡‰è¼ªå»“èˆ‡èº«é«”æ›²ç·š" checked onclick="event.stopPropagation()">
                <label for="angle2">30-45Â° æ–œå´è§’åº¦</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(3, event)">
                <input type="checkbox" id="angle3" value="ç”±ä¸Šå¾€ä¸‹ä¿¯è¦–45åº¦è§’ï¼Œå±•ç¾å…¨èº«ç™‚ç¨‹å‹•ä½œ" checked onclick="event.stopPropagation()">
                <label for="angle3">ä¿¯è¦–è§’åº¦</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(4, event)">
                <input type="checkbox" id="angle4" value="è‡‰éƒ¨ã€è‚©é ¸ç‰¹å¯«ï¼Œå±•ç¾æ”¾é¬†è¡¨æƒ…èˆ‡ç´°ç¯€" onclick="event.stopPropagation()">
                <label for="angle4">ç‰¹å¯«é ­éƒ¨</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(5, event)">
                <input type="checkbox" id="angle5" value="90åº¦å´é¢å‚ç›´æ‹æ”ï¼Œå±•ç¾å®Œæ•´èº«å½¢å´å½±" onclick="event.stopPropagation()">
                <label for="angle5">å´é¢å‚ç›´</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(6, event)">
                <input type="checkbox" id="angle6" value="å¾Œæ–¹æ–œ45åº¦è§’ï¼Œå±•ç¾èƒŒéƒ¨èˆ‡ç™‚ç¨‹æ‰‹æ³•" onclick="event.stopPropagation()">
                <label for="angle6">å¾Œæ–¹æ–œè§’</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(7, event)">
                <input type="checkbox" id="angle7" value="ä½è§’åº¦ç”±ä¸‹å¾€ä¸Šæ‹æ”ï¼Œå±•ç¾äººç‰©æ°£å‹¢èˆ‡ç©ºé–“æ„Ÿ" onclick="event.stopPropagation()">
                <label for="angle7">ä½è§’åº¦ä»°æ‹</label>
              </div>
              <div class="angle-option" onclick="toggleAngle(8, event)">
                <input type="checkbox" id="angle8" value="é æ™¯å…¨èº«ï¼ŒåŒ…å«å®Œæ•´ç’°å¢ƒèˆ‡äººç‰©é—œä¿‚" onclick="event.stopPropagation()">
                <label for="angle8">é æ™¯å…¨èº«</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>æ§‹åœ–åå¥½</label>
            <select id="composition">
              <option>äººç‰©å±…ä¸­</option>
              <option>äººç‰©åå·¦</option>
              <option>äººç‰©åå³</option>
              <option>å°è§’ç·šæ§‹åœ–</option>
              <option>ä¸‰åˆ†æ³•æ§‹åœ–</option>
              <option>å°ç¨±æ§‹åœ–</option>
            </select>
          </div>
        </div>

        <div class="card">
          <div class="card-title">è©³ç´°è¦æ±‚èˆ‡è¦æ ¼</div>
          <div class="form-group full">
            <label>è©³ç´°è¦æ±‚èˆ‡åå¥½</label>
            <textarea id="detailReq" placeholder="è«‹è©³ç´°æè¿°æ‚¨çš„åœ–ç‰‡è¦æ±‚..."></textarea>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label>åœ–ç‰‡å¼µæ•¸</label>
              <input type="number" id="imageCount" value="8" min="1" max="20">
            </div>
            <div class="form-group">
              <label>è¼¸å‡ºå°ºå¯¸</label>
              <select id="dimension">
                <option value="800x800">800x800 (æ­£æ–¹å½¢)</option>
                <option value="1080x1080">1080x1080 (æ­£æ–¹å½¢)</option>
                <option value="1200x628">1200x628 (æ©«å¼)</option>
                <option value="1080x1920">1080x1920 (ç›´å¼)</option>
              </select>
            </div>
          </div>
        </div>

        <button class="generate-btn" onclick="generateCommand()">ç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤</button>
      </div>

      <div class="output-section">
        <div class="output-header">
          <div class="output-title">ç”ŸæˆæŒ‡ä»¤</div>
          <div class="output-actions">
            <button class="btn btn-primary" onclick="copyToClipboard()">è¤‡è£½</button>
            <button class="btn btn-warning" onclick="goToGemini()">å‰å¾€ Gemini</button>
          </div>
        </div>
        <div class="output-content" id="output">
          <div class="empty-state">
            <div style="font-size: 24px; margin-bottom: 12px;">âœ¨</div>
            <div>å¡«å¯«è¡¨å–®ä¸¦é»æ“Šã€Œç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤ã€</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- æ­·ç¨‹ç´€éŒ„å½ˆçª— -->
  <div class="modal" id="historyModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">æ­·ç¨‹ç´€éŒ„</div>
        <div class="modal-header-actions">
          <button class="btn-clear-all" onclick="clearAllHistory()">æ¸…ç©ºå…¨éƒ¨ç´€éŒ„</button>
          <button class="modal-close" onclick="closeHistory()">Ã—</button>
        </div>
      </div>
      <div id="historyList" class="history-list">
        <div class="empty-state" style="padding: 40px 20px;">
          <div style="font-size: 24px; margin-bottom: 12px;">ğŸ“‹</div>
          <div>å°šç„¡æ­·ç¨‹ç´€éŒ„</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let selectedModels = [];
    let deviceImages = [];
    let historyRecords = [];

    // è¼‰å…¥æ­·ç¨‹ç´€éŒ„
    function loadHistory() {
      const saved = localStorage.getItem('spaGeneratorHistory');
      if (saved) {
        try {
          historyRecords = JSON.parse(saved);
        } catch (e) {
          historyRecords = [];
        }
      }
    }

    // å„²å­˜æ­·ç¨‹ç´€éŒ„
    function saveHistory() {
      localStorage.setItem('spaGeneratorHistory', JSON.stringify(historyRecords));
    }

    // æ¸…ç©ºå…¨éƒ¨ç´€éŒ„
    function clearAllHistory() {
      if (confirm('ç¢ºå®šè¦æ¸…ç©ºå…¨éƒ¨æ­·ç¨‹ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
        historyRecords = [];
        saveHistory();
        showToast('å·²æ¸…ç©ºå…¨éƒ¨ç´€éŒ„', 'info');
        const modal = document.getElementById('historyModal');
        if (modal.classList.contains('show')) {
          showHistory();
        }
      }
    }

    // é¡¯ç¤ºæ­·ç¨‹ç´€éŒ„
    function showHistory() {
      loadHistory();
      const modal = document.getElementById('historyModal');
      const listDiv = document.getElementById('historyList');
      
      if (historyRecords.length === 0) {
        listDiv.innerHTML = '<div class="empty-state" style="padding: 40px 20px;"><div style="font-size: 24px; margin-bottom: 12px;">ğŸ“‹</div><div>å°šç„¡æ­·ç¨‹ç´€éŒ„</div></div>';
      } else {
        listDiv.innerHTML = '';
        historyRecords.forEach((record, index) => {
          const date = new Date(record.timestamp);
          const timeStr = date.toLocaleString('zh-TW', { 
            month: '2-digit', 
            day: '2-digit', 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          
          const itemDiv = document.createElement('div');
          itemDiv.className = 'history-item';
          
          const headerDiv = document.createElement('div');
          headerDiv.className = 'history-item-header';
          
          const titleDiv = document.createElement('div');
          titleDiv.className = 'history-title';
          titleDiv.textContent = record.title || 'æœªå‘½å';
          
          const actionsDiv = document.createElement('div');
          actionsDiv.className = 'history-actions';
          
          const loadBtn = document.createElement('button');
          loadBtn.className = 'history-btn history-btn-load';
          loadBtn.textContent = 'è¼‰å…¥';
          loadBtn.onclick = function(e) {
            e.stopPropagation();
            loadRecord(index);
          };
          
          const viewBtn = document.createElement('button');
          viewBtn.className = 'history-btn history-btn-load';
          viewBtn.textContent = 'æŸ¥çœ‹æŒ‡ä»¤';
          viewBtn.style.background = '#8b9d83';
          viewBtn.onclick = function(e) {
            e.stopPropagation();
            if (record.generatedPrompt) {
              document.getElementById('output').textContent = record.generatedPrompt;
              closeHistory();
              showToast('å·²é¡¯ç¤ºæ­·å²æŒ‡ä»¤', 'success');
            } else {
              showToast('æ­¤ç´€éŒ„ç„¡å„²å­˜æŒ‡ä»¤', 'error');
            }
          };
          
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'history-btn history-btn-delete';
          deleteBtn.textContent = 'åˆªé™¤';
          deleteBtn.onclick = function(e) {
            e.stopPropagation();
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
              historyRecords.splice(index, 1);
              saveHistory();
              showHistory();
              showToast('å·²åˆªé™¤ç´€éŒ„', 'info');
            }
          };
          
          actionsDiv.appendChild(loadBtn);
          actionsDiv.appendChild(viewBtn);
          actionsDiv.appendChild(deleteBtn);
          
          headerDiv.appendChild(titleDiv);
          headerDiv.appendChild(actionsDiv);
          
          const timeDiv = document.createElement('div');
          timeDiv.className = 'history-time';
          timeDiv.textContent = timeStr;
          
          itemDiv.appendChild(headerDiv);
          itemDiv.appendChild(timeDiv);
          
          if (record.content) {
            const previewDiv = document.createElement('div');
            previewDiv.className = 'history-preview';
            previewDiv.textContent = record.content.substring(0, 100) + '...';
            itemDiv.appendChild(previewDiv);
          }
          
          listDiv.appendChild(itemDiv);
        });
      }
      
      modal.classList.add('show');
    }

    // è¼‰å…¥ç´€éŒ„ï¼ˆç”¨æ–°çš„å‡½æ•¸åé¿å…è¡çªï¼‰
    function loadRecordById(index) {
      loadRecord(index);
    }

    // åˆªé™¤ç´€éŒ„ï¼ˆç”¨æ–°çš„å‡½æ•¸åé¿å…è¡çªï¼‰
    function deleteRecordById(index) {
      if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
        historyRecords.splice(index, 1);
        saveHistory();
        showHistory();
        showToast('å·²åˆªé™¤ç´€éŒ„', 'info');
      }
    }

    // é—œé–‰æ­·ç¨‹ç´€éŒ„
    function closeHistory() {
      document.getElementById('historyModal').classList.remove('show');
    }

    // è¼‰å…¥ç´€éŒ„
    function loadRecord(index) {
      const record = historyRecords[index];
      if (!record) return;
      
      // è¼‰å…¥åŸºæœ¬è³‡è¨Š
      document.getElementById('title').value = record.title || '';
      document.getElementById('content').value = record.content || '';
      document.getElementById('detailReq').value = record.detailReq || '';
      document.getElementById('imageCount').value = record.imageCount || 8;
      
      // è¼‰å…¥è¨­è¨ˆé¢¨æ ¼
      document.getElementById('style').value = record.style || 'ç¦ªé¢¨';
      document.getElementById('tone').value = record.tone || 'ç¾ä»£';
      document.getElementById('colorTheme').value = record.colorTheme || 'ç±³ç™½ç°';
      document.getElementById('lighting').value = record.lighting || 'æŸ”å…‰';
      document.getElementById('scene').value = record.scene || 'é«˜ç´šSPAå®¤å…§';
      document.getElementById('material').value = record.material || 'å¤§ç†çŸ³';
      document.getElementById('dimension').value = record.dimension || '800x800';
      document.getElementById('composition').value = record.composition || 'äººç‰©å±…ä¸­';
      
      // è¼‰å…¥è‡ªå®šç¾©é¸é …
      if (record.styleOther) {
        document.getElementById('style').value = 'å…¶ä»–';
        document.getElementById('styleOther').value = record.styleOther;
        document.getElementById('styleOther').style.display = 'block';
      }
      if (record.toneOther) {
        document.getElementById('tone').value = 'å…¶ä»–';
        document.getElementById('toneOther').value = record.toneOther;
        document.getElementById('toneOther').style.display = 'block';
      }
      if (record.colorThemeOther) {
        document.getElementById('colorTheme').value = 'å…¶ä»–';
        document.getElementById('colorThemeOther').value = record.colorThemeOther;
        document.getElementById('colorThemeOther').style.display = 'block';
      }
      if (record.lightingOther) {
        document.getElementById('lighting').value = 'å…¶ä»–';
        document.getElementById('lightingOther').value = record.lightingOther;
        document.getElementById('lightingOther').style.display = 'block';
      }
      if (record.sceneOther) {
        document.getElementById('scene').value = 'å…¶ä»–';
        document.getElementById('sceneOther').value = record.sceneOther;
        document.getElementById('sceneOther').style.display = 'block';
      }
      if (record.materialOther) {
        document.getElementById('material').value = 'å…¶ä»–';
        document.getElementById('materialOther').value = record.materialOther;
        document.getElementById('materialOther').style.display = 'block';
      }
      
      // è¼‰å…¥æ¨¡ç‰¹é¸æ“‡
      document.querySelectorAll('.model-item input').forEach(cb => {
        cb.checked = false;
        cb.parentElement.classList.remove('selected');
      });
      if (record.selectedModels) {
        record.selectedModels.forEach(modelIndex => {
          const cb = document.getElementById('model' + modelIndex);
          if (cb) {
            cb.checked = true;
            cb.parentElement.classList.add('selected');
          }
        });
        if (record.customModel && record.selectedModels.includes(12)) {
          document.getElementById('customModel').value = record.customModel;
          document.getElementById('customModelInput').style.display = 'block';
        }
      }
      
      // è¼‰å…¥è§’åº¦é¸æ“‡
      for (let i = 1; i <= 8; i++) {
        const cb = document.getElementById('angle' + i);
        if (cb && record.angles) {
          cb.checked = record.angles.includes(i);
        }
      }
      
      updateModels();
      closeHistory();
      showToast('å·²è¼‰å…¥ç´€éŒ„', 'success');
    }

    // åˆªé™¤ç´€éŒ„
    function deleteRecord(index) {
      // é€™å€‹å‡½æ•¸ä¿ç•™ä½†ä¸ç›´æ¥ä½¿ç”¨ï¼Œæ”¹ç”¨ deleteRecordById
      if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
        historyRecords.splice(index, 1);
        saveHistory();
        showHistory();
        showToast('å·²åˆªé™¤ç´€éŒ„', 'info');
      }
    }

    // å„²å­˜ç•¶å‰è¡¨å–®ç‚ºç´€éŒ„
    function saveCurrentRecord() {
      const title = document.getElementById('title').value.trim();
      if (!title) return;
      
      const selectedModelIndexes = [];
      for (let i = 1; i <= 12; i++) {
        const cb = document.getElementById('model' + i);
        if (cb && cb.checked) {
          selectedModelIndexes.push(i);
        }
      }
      
      const selectedAngles = [];
      for (let i = 1; i <= 8; i++) {
        const cb = document.getElementById('angle' + i);
        if (cb && cb.checked) {
          selectedAngles.push(i);
        }
      }
      
      const record = {
        timestamp: Date.now(),
        title: title,
        content: document.getElementById('content').value.trim(),
        style: document.getElementById('style').value,
        styleOther: document.getElementById('styleOther').value.trim(),
        tone: document.getElementById('tone').value,
        toneOther: document.getElementById('toneOther').value.trim(),
        colorTheme: document.getElementById('colorTheme').value,
        colorThemeOther: document.getElementById('colorThemeOther').value.trim(),
        lighting: document.getElementById('lighting').value,
        lightingOther: document.getElementById('lightingOther').value.trim(),
        scene: document.getElementById('scene').value,
        sceneOther: document.getElementById('sceneOther').value.trim(),
        material: document.getElementById('material').value,
        materialOther: document.getElementById('materialOther').value.trim(),
        selectedModels: selectedModelIndexes,
        customModel: document.getElementById('customModel').value.trim(),
        angles: selectedAngles,
        composition: document.getElementById('composition').value,
        detailReq: document.getElementById('detailReq').value.trim(),
        imageCount: document.getElementById('imageCount').value,
        dimension: document.getElementById('dimension').value,
        generatedPrompt: document.getElementById('output').textContent
      };
      
      historyRecords.unshift(record);
      
      if (historyRecords.length > 20) {
        historyRecords = historyRecords.slice(0, 20);
      }
      
      saveHistory();
    }

    // é—œé–‰å½ˆçª—ï¼ˆé»æ“ŠèƒŒæ™¯ï¼‰
    document.getElementById('historyModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeHistory();
      }
    });

    function showToast(msg, type) {
      const toast = document.getElementById('toast');
      toast.className = 'toast ' + (type || 'info');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    function getVal(selectId, inputId) {
      const sel = document.getElementById(selectId);
      const inp = document.getElementById(inputId);
      if (sel && sel.value === 'å…¶ä»–' && inp && inp.value.trim()) {
        return inp.value.trim();
      }
      return sel ? sel.value : '';
    }

    function toggleModel(num, event) {
      if (event) {
        event.stopPropagation();
      }
      const cb = document.getElementById('model' + num);
      if (!cb) return;
      
      // ç›´æ¥è®€å– checkbox çš„ç•¶å‰ç‹€æ…‹ï¼Œä¸è¦åˆ‡æ›å®ƒ
      const isChecked = cb.checked;
      const item = cb.parentElement;
      
      item.classList.toggle('selected', isChecked);
      
      if (num === 12) {
        const customInput = document.getElementById('customModelInput');
        if (customInput) {
          customInput.style.display = isChecked ? 'block' : 'none';
        }
      }
      
      updateModels();
    }

    function toggleAngle(num, event) {
      if (event) {
        event.stopPropagation();
      }
      const cb = document.getElementById('angle' + num);
      if (!cb) return;
      cb.checked = !cb.checked;
    }

    function updateModels() {
      selectedModels = [];
      for (let i = 1; i <= 12; i++) {
        const cb = document.getElementById('model' + i);
        if (cb && cb.checked) {
          const lbl = cb.nextElementSibling;
          if (lbl) selectedModels.push(lbl.textContent);
        }
      }
      
      const cb12 = document.getElementById('model12');
      const customTxt = document.getElementById('customModel');
      if (cb12 && cb12.checked && customTxt && customTxt.value.trim()) {
        selectedModels[selectedModels.length - 1] = customTxt.value.trim();
      }
    }

    function generateCommand() {
      const title = document.getElementById('title').value.trim();
      const content = document.getElementById('content').value.trim();
      
      if (!title || !content) {
        showToast('è«‹å¡«å…¥èª²ç¨‹æ¨™é¡Œå’Œå…§å®¹', 'error');
        return;
      }

      const count = parseInt(document.getElementById('imageCount').value) || 8;
      const style = getVal('style', 'styleOther');
      const tone = getVal('tone', 'toneOther');
      const color = getVal('colorTheme', 'colorThemeOther');
      const light = getVal('lighting', 'lightingOther');
      const scene = getVal('scene', 'sceneOther');
      const mat = getVal('material', 'materialOther');
      const dim = document.getElementById('dimension').value;
      const comp = document.getElementById('composition').value;
      const detail = document.getElementById('detailReq').value.trim();

      const angles = [];
      for (let i = 1; i <= 8; i++) {
        const cb = document.getElementById('angle' + i);
        if (cb && cb.checked) angles.push(cb.value);
      }
      if (angles.length === 0) angles.push('30-45åº¦å´é¢è§’åº¦ï¼Œå±•ç¾å´è‡‰è¼ªå»“èˆ‡èº«é«”æ›²ç·š', 'æ­£é¢å¹³è¦–ï¼Œçœ¼ç¥æ¥è§¸ï¼Œå±•ç¾è‡‰éƒ¨è¡¨æƒ…');

      const model = selectedModels.length > 0 ? selectedModels[0] : 'å„ªé›…äºæ´²å¥³æ€§25-35æ­²';

      const lines = content.split('\n').filter(l => l.trim());
      const items = lines.filter(l => l.match(/^\d+\./) || l.includes('åˆ†é˜'));

      let prompt = '# SPAç™‚ç¨‹åœ–ç‰‡ç”Ÿæˆä»»å‹™\n\n';
      prompt += '## ğŸ“‹ é‡è¦èªªæ˜\n';
      prompt += 'è«‹ç‚ºæˆ‘ç”Ÿæˆ ' + count + ' å¼µç¨ç«‹çš„åœ–ç‰‡ï¼Œæ¯å¼µåœ–ç‰‡éƒ½è¦å®Œæ•´ç¨ç«‹ç”Ÿæˆï¼Œä¸è¦çµ„åˆæˆ–æ‹¼æ¥ã€‚\n';
      prompt += 'æˆ‘æœƒé€ä¸€æè¿°æ¯å¼µåœ–ç‰‡çš„éœ€æ±‚ï¼Œè«‹ä¾åºå®Œæˆã€‚\n\n';
      
      prompt += '## ğŸš« ç¦æ­¢äº‹é …ï¼ˆæ‰€æœ‰åœ–ç‰‡éƒ½é©ç”¨ï¼‰\n';
      prompt += '1. çµ•å°ä¸å¯åœ¨åœ–ç‰‡ä¸Šæ·»åŠ ä»»ä½•æ–‡å­—ã€æ•¸å­—ã€æ¨™é¡Œã€æµ®æ°´å°\n';
      prompt += '2. ä¸è¦å°‡å¤šå¼µåœ–ç‰‡çµ„åˆæˆä¸€å¼µ\n';
      prompt += '3. ä¸è¦è‡ªå‹•åˆ‡å‰²æˆ–è£åˆ‡åœ–ç‰‡\n';
      prompt += '4. äººç‰©å¿…é ˆèº«é«”å®Œæ•´ï¼š\n';
      prompt += '   - é ­éƒ¨å®Œæ•´ï¼ˆåŒ…å«æ•´å€‹è‡‰å’Œé ­é«®ï¼‰\n';
      prompt += '   - è»€å¹¹å®Œæ•´ï¼ˆä¸å¯å¾è…°éƒ¨æˆ–èƒ¸éƒ¨åˆ‡æ–·ï¼‰\n';
      prompt += '   - å››è‚¢å®Œæ•´ï¼ˆæ‰‹è‡‚å’Œè…¿éƒ¨éƒ½è¦å®Œæ•´å‘ˆç¾ï¼‰\n';
      prompt += '   - é—œç¯€ä½ç½®æ­£ç¢ºï¼Œæ¯”ä¾‹å”èª¿\n';
      prompt += '   - ä¸å¯æœ‰æ‰­æ›²è®Šå½¢æˆ–å¤šé¤˜è‚¢é«”\n\n';
      
      prompt += '## ğŸ¨ çµ±ä¸€é¢¨æ ¼è¨­å®š\n';
      prompt += '- æ•´é«”é¢¨æ ¼ï¼š' + style + ' + ' + tone + 'èª¿æ€§\n';
      prompt += '- ä¸»è‰²èª¿ï¼š' + color + '\n';
      prompt += '- å…‰ç·šæ•ˆæœï¼š' + light + '\n';
      prompt += '- å ´æ™¯ç’°å¢ƒï¼š' + scene + '\n';
      prompt += '- æè³ªå…ƒç´ ï¼š' + mat + '\n';
      prompt += '- æ§‹åœ–æ–¹å¼ï¼š' + comp + '\n';
      prompt += '- è¼¸å‡ºå°ºå¯¸ï¼š' + dim + ' åƒç´ \n\n';

      if (detail) {
        prompt += '## ğŸ’¡ è£œå……è¦æ±‚\n';
        prompt += detail + '\n\n';
      }

      if (deviceImages.length > 0) {
        prompt += '## ğŸ”§ ç™‚ç¨‹å„€å™¨èªªæ˜\n';
        deviceImages.forEach((img, i) => {
          const desc = img.description || 'SPAå°ˆæ¥­å„€å™¨';
          prompt += (i + 1) + '. ' + desc + '\n';
        });
        prompt += '\n';
      }

      prompt += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
      prompt += '## ğŸ“¸ è«‹ä¾åºç”Ÿæˆä»¥ä¸‹åœ–ç‰‡\n\n';

      // ç¬¬ä¸€å¼µï¼šç´”èƒŒæ™¯
      prompt += '### ã€åœ–ç‰‡ 1/' + count + 'ã€‘æµç¨‹èƒŒæ™¯åœ–\n\n';
      prompt += '**å ´æ™¯æè¿°ï¼š**\n';
      prompt += 'é€™æ˜¯ä¸€å¼µç´”ç²¹çš„è¨­è¨ˆèƒŒæ™¯åœ–ï¼Œä¸æ˜¯ç’°å¢ƒç©ºé–“ç…§ç‰‡ï¼Œè€Œæ˜¯å¯ä»¥ä½œç‚ºç™‚ç¨‹æµç¨‹èªªæ˜çš„èƒŒæ™¯åº•åœ–ã€‚\n\n';
      prompt += '**æ‹æ”è·é›¢ï¼šä¸é©ç”¨ï¼ˆé€™æ˜¯è¨­è¨ˆåœ–è€Œéæ”å½±ä½œå“ï¼‰\n\n';
      prompt += '**å…·é«”è¦æ±‚ï¼š**\n';
      prompt += '- é¡å‹ï¼šå¹³é¢è¨­è¨ˆèƒŒæ™¯ï¼Œä¸æ˜¯å¯¦æ™¯ç…§ç‰‡\n';
      prompt += '- é¢¨æ ¼ï¼š' + style + ' ' + tone + 'çš„è¨­è¨ˆæ„Ÿ\n';
      prompt += '- è‰²èª¿ï¼šä»¥' + color + 'ç‚ºä¸»è‰²èª¿\n';
      prompt += '- å…ƒç´ ï¼šå¯ä»¥æœ‰æŠ½è±¡çš„' + mat + 'æè³ªç´‹ç†æˆ–åœ–æ¡ˆ\n';
      prompt += '- å…‰å½±ï¼š' + light + 'çš„æ°›åœæ„Ÿ\n';
      prompt += '- è¨­è¨ˆé‡é»ï¼š\n';
      prompt += '  * å®Œå…¨æ²’æœ‰äººç‰©ã€å®¶å…·ã€å¯¦é«”ç‰©å“\n';
      prompt += '  * ä¹¾æ·¨ç°¡æ½”çš„è¨­è¨ˆèƒŒæ™¯\n';
      prompt += '  * å¯ä»¥æœ‰æ¼¸å±¤ã€ç´‹ç†ã€å¹¾ä½•åœ–æ¡ˆ\n';
      prompt += '  * é©åˆåœ¨ä¸Šé¢æ”¾ç½®æ–‡å­—æˆ–æµç¨‹èªªæ˜\n';
      prompt += '  * å…·æœ‰' + scene + 'çš„æ°›åœä½†ä¸æ˜¯å¯¦æ™¯\n';
      prompt += '- ç¦æ­¢ï¼šä¸è¦æ‹æ”å¯¦éš›çš„å®¤å…§ç’°å¢ƒæˆ–ç©ºé–“\n\n';
      prompt += '---\n\n';

      // å…¶ä»–å¼µï¼šæœ‰äººç‰©çš„ç™‚ç¨‹åœ–
      for (let i = 2; i <= count; i++) {
        const idx = (i - 2) % items.length;
        const item = items[idx] || 'ç™‚ç¨‹æ­¥é©Ÿ';
        const name = item.replace(/^\d+\./, '').replace(/\d+åˆ†é˜/g, '').trim();
        const ang = angles[(i - 2) % angles.length];
        
        const needDevice = deviceImages.length > 0 && (
          name.includes('å„€') || name.includes('æ©Ÿ') || 
          name.includes('æ´»åŒ–') || name.includes('æ—‹é¢¨') || name.includes('å²©ç›¤')
        );
        
        prompt += '### ã€åœ–ç‰‡ ' + i + '/' + count + 'ã€‘' + name + '\n\n';
        prompt += '**å ´æ™¯æè¿°ï¼š**\n';
        prompt += model + 'æ­£åœ¨' + scene + 'ä¸­é€²è¡Œ' + name + 'ç™‚ç¨‹ã€‚\n\n';
        prompt += '**æ‹æ”è·é›¢ï¼šä¸­è¿‘æ™¯ç‰¹å¯«ï¼Œè¦èƒ½æ¸…æ¥šçœ‹åˆ°äººç‰©è¡¨æƒ…èˆ‡ç™‚ç¨‹ç´°ç¯€ï¼Œä¸è¦æ‹å¤ªé \n\n';
        prompt += '**å…·é«”è¦æ±‚ï¼š**\n';
        prompt += '- èƒŒæ™¯ç’°å¢ƒï¼šä¿ç•™' + scene + 'çš„æ°›åœèƒŒæ™¯\n';
        prompt += '- èƒŒæ™¯é¢¨æ ¼ï¼š' + style + ' ' + tone + 'ï¼Œ' + color + 'è‰²èª¿\n';
        prompt += '- èƒŒæ™¯è™•ç†ï¼šè‡ªç„¶æŸ”ç„¦ä½†ä»å¯è¾¨è­˜æ˜¯' + scene + '\n';
        prompt += '- äººç‰©ï¼š' + model + 'ï¼Œè¡¨æƒ…æ”¾é¬†æ„‰æ‚…\n';
        prompt += '- äººç‰©è·é›¢ï¼šä¸­è¿‘æ™¯ï¼Œèƒ½æ¸…æ¥šçœ‹åˆ°è¡¨æƒ…å’Œå‹•ä½œ\n';
        prompt += '- æ‹æ”è§’åº¦ï¼š' + ang + '\n';
        prompt += '- æ§‹åœ–æ–¹å¼ï¼š' + comp + '\n';
        prompt += '- å…‰ç·šæ•ˆæœï¼š' + light + '\n';
        if (needDevice) {
          prompt += '- ç™‚ç¨‹é“å…·ï¼šä½¿ç”¨ä¸Šè¿°æåˆ°çš„å°ˆæ¥­å„€å™¨\n';
        }
        prompt += '- äººç‰©å‘ˆç¾ï¼š\n';
        prompt += '  * æ•´å€‹èº«é«”éƒ½è¦å®Œæ•´å‡ºç¾åœ¨ç•«é¢ä¸­\n';
        prompt += '  * å¾é ­åˆ°è…³éƒ½è¦çœ‹å¾—åˆ°ï¼ˆæˆ–è‡³å°‘åˆ°è†è“‹ä»¥ä¸Šï¼‰\n';
        prompt += '  * èº«é«”æ¯”ä¾‹è‡ªç„¶å”èª¿\n';
        prompt += '  * å§¿å‹¢ç¬¦åˆ' + name + 'çš„æƒ…å¢ƒ\n';
        prompt += '  * è‚¢é«”æ”¾é¬†ï¼Œè¡¨æƒ…èˆ’é©\n';
        prompt += '- ç•«é¢ï¼šå–®ä¸€å®Œæ•´å ´æ™¯ï¼Œä¸åˆ‡å‰²ï¼Œä¸è¦æ‹å¤ªé å¤ªå»£è§’\n\n';
        prompt += '---\n\n';
      }

      // å¦‚æœæœ‰å„€å™¨ï¼Œé¡å¤–ç”Ÿæˆ3å¼µå„€å™¨åœ–
      if (deviceImages.length > 0) {
        const totalWithDevice = count + 3;
        
        prompt += '\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
        prompt += '## ğŸ”§ é¡å¤–å„€å™¨å±•ç¤ºåœ–ç‰‡\n\n';
        
        prompt += '### ã€åœ–ç‰‡ ' + (count + 1) + '/' + totalWithDevice + 'ã€‘å„€å™¨ç”¢å“ç…§\n\n';
        prompt += '**å ´æ™¯æè¿°ï¼š**\n';
        prompt += 'å°ˆæ¥­çš„å•†å“æ”å½±é¢¨æ ¼ï¼Œå±•ç¤ºSPAç™‚ç¨‹å„€å™¨ã€‚\n\n';
        prompt += '**å…·é«”è¦æ±‚ï¼š**\n';
        prompt += '- èƒŒæ™¯ï¼šç´”ç™½è‰²èƒŒæ™¯\n';
        prompt += '- æ‹æ”è§’åº¦ï¼š45åº¦æ–œè§’\n';
        prompt += '- å…‰ç·šï¼šæŸ”å’Œå‡å‹»çš„æ”å½±æ£šå…‰ç·š\n';
        prompt += '- é‡é»ï¼šå„€å™¨æ¸…æ™°ç‰¹å¯«ï¼Œå±•ç¾ç”¢å“ç´°ç¯€\n';
        prompt += '- é¢¨æ ¼ï¼šå°ˆæ¥­å•†å“æ”å½±è³ªæ„Ÿ\n\n';
        prompt += '---\n\n';
        
        prompt += '### ã€åœ–ç‰‡ ' + (count + 2) + '/' + totalWithDevice + 'ã€‘å„€å™¨ä½¿ç”¨æƒ…å¢ƒ\n\n';
        prompt += '**å ´æ™¯æè¿°ï¼š**\n';
        prompt += 'åœ¨' + scene + 'ä¸­ï¼Œå°ˆæ¥­æ²»ç™‚å¸«æ­£åœ¨ç‚ºå®¢äººä½¿ç”¨ç™‚ç¨‹å„€å™¨ã€‚\n\n';
        prompt += '**å…·é«”è¦æ±‚ï¼š**\n';
        prompt += '- å ´æ™¯ï¼š' + scene + '\n';
        prompt += '- äººç‰©ï¼šæ²»ç™‚å¸« + å®¢äººï¼Œå…©äººèº«é«”éƒ½è¦å®Œæ•´\n';
        prompt += '- å‹•ä½œï¼šæ²»ç™‚å¸«å°ˆæ¥­åœ°æ“ä½œå„€å™¨\n';
        prompt += '- æ°›åœï¼šå°ˆæ¥­ã€æº«é¦¨ã€èˆ’é©\n';
        prompt += '- é‡é»ï¼šå±•ç¾å„€å™¨çš„å¯¦éš›ä½¿ç”¨æ–¹å¼\n';
        prompt += '- äººç‰©å®Œæ•´æ€§ï¼šå…©å€‹äººçš„èº«é«”éƒ½è¦å¾é ­åˆ°è…³å®Œæ•´å‘ˆç¾\n\n';
        prompt += '---\n\n';
        
        prompt += '### ã€åœ–ç‰‡ ' + (count + 3) + '/' + totalWithDevice + 'ã€‘å„€å™¨ç©ºé–“é™³è¨­\n\n';
        prompt += '**å ´æ™¯æè¿°ï¼š**\n';
        prompt += 'ç™‚ç¨‹å„€å™¨å„ªé›…åœ°æ“ºæ”¾åœ¨' + style + 'é¢¨æ ¼çš„SPAç©ºé–“ä¸­ã€‚\n\n';
        prompt += '**å…·é«”è¦æ±‚ï¼š**\n';
        prompt += '- å ´æ™¯ï¼š' + style + 'é¢¨æ ¼çš„' + scene + '\n';
        prompt += '- å…§å®¹ï¼šå„€å™¨ä½œç‚ºç©ºé–“çš„ä¸€éƒ¨åˆ†è‡ªç„¶èå…¥\n';
        prompt += '- é¢¨æ ¼ï¼š' + style + ' ' + tone + '\n';
        prompt += '- è‰²èª¿ï¼š' + color + '\n';
        prompt += '- é‡é»ï¼šå±•ç¾å„€å™¨èˆ‡æ•´é«”ç©ºé–“çš„å’Œè«§æ­é…\n';
        prompt += '- è¦–è§’ï¼šèƒ½çœ‹åˆ°ç©ºé–“æ•´é«”èˆ‡å„€å™¨çš„é—œä¿‚\n\n';
      }

      prompt += '\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
      prompt += '## âœ… æœ€çµ‚ç¢ºèªæ¸…å–®\n\n';
      prompt += 'è«‹ç¢ºèªä»¥ä¸‹äº‹é …ï¼š\n';
      prompt += '- [ ] ç¸½å…±ç”Ÿæˆ ' + count + (deviceImages.length > 0 ? ' + 3 = ' + (count + 3) : '') + ' å¼µç¨ç«‹åœ–ç‰‡\n';
      prompt += '- [ ] æ¯å¼µåœ–ç‰‡éƒ½æ˜¯å®Œæ•´çš„å–®ä¸€å ´æ™¯\n';
      prompt += '- [ ] ç¬¬1å¼µæ˜¯ç´”èƒŒæ™¯ï¼Œæ²’æœ‰ä»»ä½•äººç‰©\n';
      prompt += '- [ ] æ‰€æœ‰äººç‰©åœ–ç‰‡ä¸­ï¼Œäººç‰©èº«é«”éƒ½å®Œæ•´å‘ˆç¾\n';
      prompt += '- [ ] æ²’æœ‰åœ¨ä»»ä½•åœ–ç‰‡ä¸Šæ·»åŠ æ–‡å­—æˆ–æ¨™è¨˜\n';
      prompt += '- [ ] æ¯å¼µåœ–ç‰‡éƒ½ç¬¦åˆä¸Šè¿°çš„è©³ç´°æè¿°\n';
      prompt += '- [ ] äººé«”æ¯”ä¾‹æ­£ç¢ºï¼Œæ²’æœ‰è®Šå½¢æˆ–åˆ‡å‰²\n\n';
      prompt += 'è«‹é–‹å§‹ä¾åºç”Ÿæˆæ¯ä¸€å¼µåœ–ç‰‡ã€‚è¬è¬ï¼\n';

      document.getElementById('output').textContent = prompt;
      
      saveCurrentRecord();
      
      showToast('æŒ‡ä»¤å·²ç”Ÿæˆ', 'success');
    }

    function copyToClipboard() {
      const text = document.getElementById('output').textContent;
      if (text.includes('å¡«å¯«è¡¨å–®')) {
        showToast('è«‹å…ˆç”ŸæˆæŒ‡ä»¤', 'error');
        return;
      }
      navigator.clipboard.writeText(text).then(() => {
        showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿', 'success');
      }).catch(() => {
        showToast('è¤‡è£½å¤±æ•—', 'error');
      });
    }

    function goToGemini() {
      const text = document.getElementById('output').textContent;
      if (text.includes('å¡«å¯«è¡¨å–®')) {
        showToast('è«‹å…ˆç”ŸæˆæŒ‡ä»¤', 'error');
        return;
      }
      copyToClipboard();
      window.open('https://gemini.google.com/', '_blank');
    }

    function fillExample() {
      document.getElementById('title').value = 'é€†æ™‚å…‰æ¢é›™äº«SPA';
      document.getElementById('content').value = '1. å…¨èƒŒå°ˆæ¥­æ‰‹æŠ€èˆ’å£“ 30åˆ†é˜\n2. ç†±æ—‹é¢¨èˆ’å£“è­·ç† 30åˆ†é˜\n3. è‚ŒåŠ›æ´»åŒ–é›™æ•ˆå„€ 20åˆ†é˜\n4. è…¿éƒ¨æ·‹å·´æ’æ°´ 30åˆ†é˜\n5. é ­éƒ¨æ”¾é¬†è­·ç† 10åˆ†é˜';
      document.getElementById('style').value = 'æ¥µç°¡';
      document.getElementById('tone').value = 'å°ˆæ¥­';
      document.getElementById('model1').checked = true;
      document.getElementById('model1').parentElement.classList.add('selected');
      updateModels();
      showToast('ç¯„ä¾‹å·²å¡«å…¥', 'success');
    }

    function clearForm() {
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('detailReq').value = '';
      document.getElementById('imageCount').value = '8';
      document.getElementById('customModel').value = '';
      document.getElementById('styleOther').value = '';
      document.getElementById('toneOther').value = '';
      document.getElementById('colorThemeOther').value = '';
      document.getElementById('lightingOther').value = '';
      document.getElementById('sceneOther').value = '';
      document.getElementById('materialOther').value = '';
      document.getElementById('styleOther').style.display = 'none';
      document.getElementById('toneOther').style.display = 'none';
      document.getElementById('colorThemeOther').style.display = 'none';
      document.getElementById('lightingOther').style.display = 'none';
      document.getElementById('sceneOther').style.display = 'none';
      document.getElementById('materialOther').style.display = 'none';
      document.getElementById('customModelInput').style.display = 'none';
      
      document.querySelectorAll('.model-item input').forEach(cb => {
        cb.checked = false;
        cb.parentElement.classList.remove('selected');
      });
      
      document.getElementById('angle1').checked = true;
      document.getElementById('angle2').checked = true;
      document.getElementById('angle3').checked = true;
      document.getElementById('angle4').checked = false;
      document.getElementById('angle5').checked = false;
      document.getElementById('angle6').checked = false;
      document.getElementById('angle7').checked = false;
      document.getElementById('angle8').checked = false;
      
      deviceImages = [];
      document.getElementById('devicePreview').style.display = 'none';
      document.getElementById('devicePreview').innerHTML = '';
      document.getElementById('deviceInput').value = '';
      
      updateModels();
      document.getElementById('output').innerHTML = '<div class="empty-state"><div style="font-size: 24px; margin-bottom: 12px;">âœ¨</div><div>å¡«å¯«è¡¨å–®ä¸¦é»æ“Šã€Œç”Ÿæˆå°ˆæ¥­AIæŒ‡ä»¤ã€</div></div>';
      showToast('è¡¨å–®å·²æ¸…ç©º', 'info');
    }

    ['style', 'tone', 'colorTheme', 'lighting', 'scene', 'material'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('change', function() {
          const inp = document.getElementById(id + 'Other');
          if (inp) {
            inp.style.display = this.value === 'å…¶ä»–' ? 'block' : 'none';
            if (this.value !== 'å…¶ä»–') inp.value = '';
          }
        });
      }
    });

    const deviceInput = document.getElementById('deviceInput');
    if (deviceInput) {
      deviceInput.addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;
        
        files.forEach(file => {
          if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              deviceImages.push({
                file: file,
                src: ev.target.result,
                name: file.name,
                description: ''
              });
              showDevicePreview();
            };
            reader.readAsDataURL(file);
          }
        });
        showToast('åœ–ç‰‡å·²ä¸Šå‚³', 'success');
      });
    }

    function showDevicePreview() {
      const preview = document.getElementById('devicePreview');
      if (!preview) return;
      
      if (deviceImages.length > 0) {
        preview.style.display = 'block';
        let html = '';
        deviceImages.forEach((img, i) => {
          html += '<div style="background: rgba(168,181,160,0.1); border-radius: 6px; padding: 12px; margin-bottom: 10px;">';
          html += '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">';
          html += '<img src="' + img.src + '" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">';
          html += '<div style="flex: 1; font-size: 12px; font-weight: 500;">' + img.name + '</div>';
          html += '<button class="btn" style="background: #c4a882; color: white; padding: 4px 12px; font-size: 11px;" onclick="removeDevice(' + i + ')">ç§»é™¤</button>';
          html += '</div>';
          html += '<input type="text" id="deviceDesc' + i + '" placeholder="å„€å™¨æè¿°ï¼šä¾‹å¦‚ å²©ç›¤æµ´è¨­å‚™:é»‘è‰²åœ“æŸ±ç‹€å²©ç›¤çŸ³æ¿" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" value="' + (img.description || '') + '" onchange="updateDeviceDesc(' + i + ', this.value)">';
          html += '</div>';
        });
        preview.innerHTML = html;
      } else {
        preview.style.display = 'none';
      }
    }

    function updateDeviceDesc(index, desc) {
      if (deviceImages[index]) {
        deviceImages[index].description = desc;
      }
    }

    function removeDevice(index) {
      deviceImages.splice(index, 1);
      showDevicePreview();
      showToast('å·²ç§»é™¤å„€å™¨åœ–ç‰‡', 'info');
    }

    loadHistory();
    console.log('SPAè¨­è¨ˆæŒ‡ä»¤ç”Ÿæˆå™¨å·²å°±ç·’');
  </script>
</body>
</html>
